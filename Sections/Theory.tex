\section{Settings}
In this section, we start by presenting the departure time choices problem for individual users. Then we proceed by characterizing the optimal departure time under different scheduling preferences and exogenous travel time profiles.


\subsection{Arrival times and travel costs}
\label{sec:cost_fn}

\label{sec:theory}

Consider some users commuting between an origin and a destination. The travel time between the origin-destination (OD) pair fluctuates across the time of the day. To hedge against time-varying congestion, some users may be motivated to arrive early and later at their destinations to avoid the rush hours.



To capture such trade-offs, we follow the bottleneck model by considering that each user chooses an arrival time $t_a$ at their destination that minimizes their individual travel cost  \footnote{When $tt_a'(t_a) < 1$ for all $t \in \mathcal{T}$, it is consistent with the departure time choice problem in \cite{arnott1993structural}. The reason is that there will be a one-to-one correspondence between any arrival time $t_a$ and the departure time $t_d = t_a - tt_a(t_a)$ because $\partial t_d/\partial t_a > 0$ in this case. }. Let $\mathcal{T}$ be the set of all possible arrival times. The travel cost by arriving at any time $t_a 
 \in \mathcal{T}$ is defined as 
\begin{equation}
  \label{eq:cost_ta}
  C(t_a) = \alpha tt_a(t_a) + \beta[t^*-t_a]^+ + \gamma[t_a-t^*]^+,
\end{equation}
where $tt_a(t_a)$ denotes the experienced travel time for travelers arriving at time $t_a$, \(t^*\) is the desired arrival time at the destination,  \(\alpha\) is the value of travel time, and \(\beta\) and \(\gamma\) are respectively the unit costs of arriving early and late at the destination. Without loss of generally, from now on, we normalize the value of $\alpha$ to 1.


 An implied assumption here is that all travelers arriving at the same destination would always experience the same travel time, which enables the definition of $tt_a(t_a)$.  In addition, we start with a representative congestion pattern such that the travel time profile function is subject to the following assumption. 


\begin{assumption}
   The travel time profile function $tt_a(t_a)$ is differentiable at all $t_a \in \mathcal{T}$.
\end{assumption}


 


\subsection{d}


Further, we consider that the congestion pattern, described by the travel time profile, is such that a traveler will not arrive earlier than anyone who departs earlier than her/him, which is termed as the first-in-first-out (FIFO) rule in literature. Thus, we impose the following assumption regarding the travel time function  $tt_a(t_a)$.



\begin{assumption}\label{ass:FIFO}
The travel time profile function $tt_a(t_a)$ is differentiable, and $tt'_a(t_a) \le 1$. 
\end{assumption}


Under Assumption \ref{ass:FIFO}, the FIFO principle is always satisfied. To see this, it is equivalent to show that the arrival time $t_a$ is weakly increasing in the departure time $t_d$, i.e., $\partial t_d / \partial t_a \ge 0$ under Assumption \ref{ass:FIFO}.  Note that by definition, we have $ t_d = t_a - tt_a(t_a)  $.  Obviously, when $tt'_a(t_a) \le 1$, we have $\partial t_d / \partial t_a = 1 - tt_a'(t_a) \ge 0$. Therefore, a traveler will arrive earlier if she departs earlier. 



$C(t_a)$, i.e.,  $t_a^* = \text{arg} \min C(t_a)$. The individual travel cost $C(t_a)$ is defined as 

we consider a cost function of the form

\begin{equation}
  \label{eq:cost-t_d}
  C(t_d; \alpha, \beta, \gamma, t^*) = \alpha tt(t_d) + \beta[t^*-t_d-tt(t_d)]^+ + \gamma[t_d+tt(t_d)-t^*]^+ 
\end{equation}
where
\begin{itemize}
\item \(t_d\) is a possible departure time, on which the cost depends
\item \(t^*\) is the desired arrival time
\item \(\alpha\) is the value of time spent travelling
\item \(\beta\) is the value of time spent waiting there
\item \(\gamma\) is the value of time arriving late
\item \(tt(t_d)\) is the time spent traveling if leaving at time \(t_d\)
\item \([x]^+ = \max(0, x)\)
\end{itemize}

We will consider, in this article,
how the cost depends on the time at which a person arrives,
rather than the time at which the person departs.
Since the travel time is known without uncertainty,
the users will then be able to make a choice based on their arrival time.

Let thus
\begin{equation}
  \label{eq:t_a-t_d}
  t_a(t_d) = t_d + tt(t_d)
\end{equation}
be the function linking the departure time to the arrival time.
The following holds:
\begin{obs}
  \label{obs:inv-t_a}
  The function \(t_a(t_d)\) is invertible
\end{obs}
This simply follows from noting that  \(t_a(t_d)\) must be strictly increasing:
this corresponds to the traffic following a First In First Out (FIFO) logic,
that is, a later departure cannot result in an earlier arrival:
a reasonable assumption that we make on the travel time function.

The function \(t_d(t_a)\) that, given an arrival time,
yields the unique departure time that would result in the given arrival,
is thus well defined.
The travel time function can hence be defined in term of the arrival time:
\begin{definition}
  \label{def:tta}
  Let
  \begin{equation*}
    tt:\R \rightarrow \R
  \end{equation*}
  be a function expressing the travel time in terms of the departure time.
  The function \(tt_a\), expressing the travel time in terms of the arrival time, is defined as follows:
  \begin{equation*}
    tt_a(t_a) = tt(t_d(t_a))
  \end{equation*}
\end{definition}

The assumption of the traffic following a FIFO logic has different implications,
on the functions \(tt\) and \(tt_a\):

\begin{lemma}
  \label{lemma:bounded-der-tt}
  Suppose the travel time functions \(tt, tt_a\) to be differentiable.
  
  The traffic follows a First In First Out logic if and only if the function \(tt\) satisfies
  \begin{equation*}
    tt'(t_d) > -1\quad \forall \, t_d
  \end{equation*}
  or, equivalently, the function on arrival time \(tt_a\) satisfies
  \begin{equation*}
    tt_a'(t_a) < 1\quad \forall \, t_a
  \end{equation*}
\end{lemma}
\begin{proof}
  Note that the traffic follows a FIFO logic if and only if the function \(t_a(t_d)\) is strictly increasing,\todo{split sentence}
  and, once defined, its inverse \(t_d(t_a)\) will be so.
  
  Being \(t_a(t_d)\) differentiable, it is strictly increasing if and only if its derivative is positive:
  \begin{align*}
    \diffp{}{{t_d}} t_a(t_d) & > 0 \\
    1 + tt'(t_d) & > 0 \\
    tt'(t_d) & > -1
  \end{align*}
  
  Alternatively, consider its inverse
  \begin{equation*}
    t_d(t_a) = t_a - tt_a(t_a)
  \end{equation*}

  Again, it is increasing if and only if it has positive derivative:
  \begin{align*}
    \diffp{}{{t_a}} t_d(t_a) & > 0 \\
    1 - tt_a'(t_a) & > 0 \\
    tt_a'(t_a) < 1
  \end{align*}
\end{proof}

Once this needed property on the travel time function was stated,
the cost function can be simplified by expressing it in function of the arrival time:
by using equation \eqref{eq:t_a-t_d} and Definition~\ref{def:tta},
the expression for the cost in~\eqref{eq:cost-t_d} indeed simplifies,
becoming

\begin{equation}
  \label{eq:cost-t_a}
  C(t_a; \alpha, \beta, \gamma, t^*) = \alpha tt_a(t_a) + \beta[t^*- t_a]^+ + \gamma[t_a - t^*]^+ 
\end{equation}
where the dependency of \(t_a\) on the departure time \(t_d\) has been hidden:
the arrival time can indeed be directly observed,
and its dependency on the departure time neglected.

In the following article,
the expression used will be the one given the arrival time, as shown in~\eqref{eq:cost-t_a},
being that a simpler expression if compared to the original one in~\eqref{eq:cost-t_d}.

We will, lastly normalize \(\alpha\) to 1.
This is possible since the cost can be considered up to a multiplicative constant.
Instead of the real cost \(C\) we will thus consider a scaled version of it \(C/\alpha\),
and minimize the following:
\begin{equation}
  \label{eq:cost_final}
  C(t_a; \beta, \gamma, t^*) = tt_a(t_a) + \beta[t^*- t_a]^+ + \gamma[t_a - t^*]^+ 
\end{equation}

The notation is here ambiguous regarding the cost \(C\) and the coefficients \(\beta,\gamma\).
It anyway doesn't lose in generality, and was chosen for simplicity.

\subsection{Minimum of the Cost Function}
\label{sec:cost_minima}

Consider hence the cost in \eqref{eq:cost_final},
and the problem of finding the minimum of it.
Before computing the first order condition,
in order to find the global minimum it is useful to do some qualitative reasoning on the values taken by the cost function.

Note that, indeed, a value \(t_0\) for the arrival time can only be greater,
smaller or equal to the given \(t^*\).
In the following definition,
the two cases are separated, so that they can be studied independently.
\begin{definition}
  Let values for the parameters \(\beta, \gamma, t^*\) be fixed.
  \begin{itemize}
  \item The \textbf{optimal early arrival} \(t_e^{opt}\) is the early arrival realizing the least cost:
    \begin{equation*}
      t_e^{opt}(\beta, \gamma ,t^*) = \argmin_{t_a < t^*}C(t_a; \beta, \gamma, t^*)
    \end{equation*}
  \item The \textbf{optimal late arrival} \(t_l^{opt}\) is the late arrival realizing the least cost:
    \begin{equation*}
      t_l^{opt}(\beta, \gamma ,t^*) = \argmin_{t_a > t^*}C(t_a; \beta, \gamma, t^*)
    \end{equation*}
  \item The \textbf{optimal arrival} \(t^{opt}\) is the arrival realizing the least cost:
    \begin{equation*}
      t^{opt}(\beta, \gamma ,t^*) = \argmin_{t_a}C(t_a; \beta, \gamma, t^*)
    \end{equation*}
  \end{itemize}
\end{definition}

Please note that in general,
optimal early and late arrivals may not exist,
depending on the choice of the travel time function and the parameters.
The zones in which these minima exist will be studied later.

For studying where these minima occur, consider now the case of an early arrival \(t_a = t_0 < t^*\).
Since
\begin{equation*}
  t_0 - t^* < 0
\end{equation*}
the cost simplifies, becoming
\begin{align}
  C(t_0; \beta, \gamma, t^*) & = tt_a(t_0) + \beta[t^*- t_0]^+ + \gamma[t_0 - t^*]^+ \nonumber \\
                             & = tt_a(t_0) + \beta(t^*- t_0)\label{eq:cost_early}
\end{align}

\begin{figure}
  \centering
  \includegraphics[width=.8\textwidth]{early_arrivals_cost}
  \caption{Dependency of the cost on the arrival time, for early arrival.
    The solid lines are parallel, of slope \(\beta\).
  Note that their distance is the only factor affecting the cost of an early arrival}
  \label{fig:early_arrivals_cost}
\end{figure}

The cost will thus be, as expected,
the sum of the travel time and a term linear on the distance of the actual arrival from the desired one.

Figure \ref{fig:early_arrivals_cost} displays how the cost of an early arrival changes when varying the arrival time:
the cost is only determined by the distance of the lines of slope \(\beta\) between each other, that is,
the projected distance of the points \(tt_a(t_a)\) on the axis orthogonal to the lines determining the cost
(the one described by \(y = -x/\beta\)).

This reasoning leads to the following lemma:
\begin{lemma}
  \label{lemma:cost_decoupled}
  If an optimal early arrival \(t_e^{opt}\) exists,
  it can be found by solving a simple minimization problem:
  \begin{equation*}
    t_e^{opt} = \argmin_{t_a < t^*} (tt_a(t_a) - \beta t_a)
  \end{equation*}

  Similarly, if an optimal late arrival exists,
  it is
  \begin{equation*}
    t_l^{opt} = \argmin_{t_a > t^*} (tt_a(t_a) + \gamma t_a)
  \end{equation*}
\end{lemma}
\begin{proof}
  The claim for early arrivals simply follows from the expression for the cost in~\eqref{eq:cost_early}:
  the following indeed holds for \(t_a < t^*\)
  \begin{align*}
    C(t_a; \beta, \gamma, t^*) & = tt_a(t_a) + \beta(t^*- t_a) \\
                               & = tt_a(t_a) + \beta t^* - \beta t_a
  \end{align*}

  But \(\beta t^*\) is clearly constant in \(t_a\),
  and minimization is invariant on translations.
  This yields
  \begin{align*}
    t_e^{opt} & = \argmin_{t_a < t^*} C(t_a) \\
              & = \argmin_{t_a < t^*} (tt_a(t_a) + \beta t^* - \beta t_a) \\
              & = \argmin_{t_a < t^*} (tt_a(t_a) - \beta t_a)
  \end{align*}

  Regarding late arrivals, the argument is symmetrical and thus omitted.
\end{proof}

Note that this has some trivial implication on the value of the derivative of the travel time function at the optimal points:
\begin{obs}
  \label{obs:foc}
  The derivative of the travel time function \(tt_a'\) is fixed at the optimal points:
  \begin{itemize}
  \item \(tt_a'(t_e^{opt}) = \beta\)
  \item \(tt_a'(t_l^{opt}) = -\gamma\)
  \end{itemize}
\end{obs}

This follows from the Lemma above:
if the function \(tt_a\) is differentiable, being the minima computed over an open set,
if they exist they necessarily satisfy the first order conditions.
For the early arrivals, they are
\begin{align*}
  \diffp{}{{t_a}} \left(tt_a(t_a) - \beta t_a\right) & = 0 \\
  tt_a'(t_a) & = \beta
\end{align*}
The case for late arrival is analogous.

While not particularly difficult to retrieve,
the expression in Lemma~\ref{lemma:cost_decoupled} is useful,
since it makes a clearer decoupling of the dependencies of the point that minimizes the cost on the parameters \(\beta, \gamma\) and \(t^*\).
We can indeed see how changing the parameters affects the location of the points \(t_e^{opt}, t_l^{opt}\).
This is described by the following proposition:
\begin{prop}
  \label{prop:into-early-late}
  Given a value for the parameters \(\beta, \gamma\),
  there exist two collections of disjoint intervals
  \begin{align*}
    E & = \{(t_e^i, \bar{t_e^i})\}_i,\quad i = 1, \dots, n \\
    L & = \{(\bar{t_l^j}, t_l^j)\}_j,\quad j = 1, \dots, m \\
  \end{align*}
  such that, if exists a value for \(i\) such that \(t^* \in (t_e^i, \bar{t_e^i})\),
  the optimal early arrival will be the lower bound of the interval:
  \begin{equation*}
    t_e^{opt}(\beta, \gamma, t^*) = t_e^{i}
  \end{equation*}

  Similarly, if exists a value for \(j\) such that \(t^* \in (\bar{t_l^j}, t_l^j)\),
  the optimal late arrival will be the upper bound of the interval:
  \begin{equation*}
    t_l^{opt}(\beta, \gamma, t^*) = t_l^{j}
  \end{equation*}

  If such a value for \(i\) (or \(j\)) does not exist,
  then the optimal early (respectively, late) arrival is not defined.
\end{prop}

\begin{proof}
  If there is no \(t^*\) for which an optimal early arrival is defined,
  then setting \(n = 0\) trivially proves the proposition.

  Suppose now that there exist a desired arrival time \(t_0\) such that \(t_e^{opt}(\beta, \gamma, t_0)\) is defined.

  Since we are assuming \(tt_a\) to be continuous\todo{Where is this assumption stated?},
  the cost will be continuous as well,
  and early arrivals can approximate arbitrarily well the cost of an on-time arrival:
  \begin{equation*}
    \forall\, \varepsilon > 0\ \exists\, t < t_0 |\ C(t_\varepsilon; \beta, \gamma, t_0) < C(t_0; \beta, \gamma, t_0) + \varepsilon
  \end{equation*}

  Note now that the cost of arriving at the desired arrival time \(t_0\) is equal to the value of the travel time function at that point:
  \begin{align*}
     C(t_\varepsilon; \beta, \gamma, t_0) & < C(t_0; \beta, \gamma, t_0) + \varepsilon \\
                              & = tt_a(t_0) + \varepsilon
  \end{align*}
  but since arrival at \(t_e^{opt}(t_0)\)\footnote{Note that, for the content of this proof, dependency of \(t_e^{opt}\) on the parameters \(\beta, \gamma\) is not relevant, and thus hidden.} minimizes the cost for \(t < t_0\),
  it costs in particular less than arriving at \(t_\varepsilon\).
  By using this, and the definition of the cost, we get
  \begin{align*}
    tt_a(t_e^{opt}(t_0)) & < tt_a(t_e^{opt}(t_0)) + \beta(t_0 - t_e^{opt}(t_0)) \\
                                        & = C(t_e^{opt}(t_0)) \\
                                        & < C(t_\varepsilon) \\
                                        & < tt_a(t_0) + \varepsilon
  \end{align*}
  for every choice of \(\varepsilon > 0\).
  The soft inequality holds thus for \(\varepsilon = 0\):
  \begin{equation*}
    tt_a(t_e^{opt}(t_0)) \leq tt_a(t_0)
  \end{equation*}

  Suppose now the desired arrival time to be in between \(t_e^{opt}(t_0)\) and \(t_0\):
  \begin{equation*}
    t^* \in (t_e^{opt}(t_0), t_0]
  \end{equation*}
  The optimal early arrival, when the desired arrival time is \(t^*\),
  will be defined and equal to \(t_e^{opt}(t_0)\).
  
  Suppose indeed by contradiction
  \begin{equation*}
    t_e^{opt}(t^*) \neq t_e^{opt}(t_0)
  \end{equation*}

  Necessarily, \(t_e^{opt}((t^*) < t_0\), since
  \begin{equation*}
    t_e^{opt}((t^*) < t^* < t_0
  \end{equation*}
  \(t_e^{opt}(t^*)\) is thus a realizable early arrival when desired arrival time is \(t_0\) as well,
  and its cost will be lower than the cost of arriving at \(t_e^{opt}(t_0)\):
  \begin{align*}
    C(t_e^{opt}(t_0); \beta, \gamma, t^*) & = tt_a(t_e^{opt}(t_0)) + \beta(t^* - t_e^{opt}(t^*)) \\
    & < tt_a(t_e^{opt}(t_0)) + \beta(t_0 - t_e^{opt}(t^*)) \\
    & = C(t_e^{opt}(t_0); \beta, \gamma, t_0)
  \end{align*}

  But this is a contradiction, since \(t_e^{opt}(t_0)\) realizes the minimal cost for an early arrival for desired arrival time \(t_0\).
  As the desired arrival time changes in the interval \((t_e^{opt}(t_0), t_0]\),
  the optimal early arrival will thus be constant and equal to \(t_e^{opt}(t_0)\).

  Let now \(\bar{t_e}\) be the first time point in which the cost of arriving early is equal to the cost of arriving on time:
  \begin{equation*}
    \bar{t_e} = \inf\{t |\ C(t_e^{opt}(t_0); \beta, \gamma, t) = tt_a(t), t > t_e^{opt}(t_0)\}
  \end{equation*}

  Note that \(\bar{t_e}\) is well defined:
  there exists indeed at least one value of \(t > t_e^{opt}(t_0)\) for which \(C(t_e^{opt}(t_0); \beta, \gamma, t) = tt_a(t)\),
  and this is a trivial consequence of the fact that the travel time is bounded\todo{Should this be in the hypotheses as well? Is it trivially assumed?}.

  Suppose now the desired arrival time to be in between \(t_0\) and \(\bar{t_e}\):
  \begin{equation*}
    t^* \in [t_0, \bar{t_e})
  \end{equation*}
  and again, towards a contradiction, suppose
  \begin{equation*}
    t_e^{opt}(t^*) \neq t_e^{opt}(t_0)
  \end{equation*}

  If \(t_e^{opt}(t^*) < t_0\), a similar argument to the one in the preceding case can be used:
  
  Early arrival at \(t_e^{opt}(t^*)\) is still realizable with desired arrival time \(t_0\).
  Note now that arriving at the same time point,
  while desiring a later arrival, increases the cost by a factor that is linear in how later the arrival is:
  it is indeed true
  \begin{equation}
    \label{eq:shifting_desired}
    \begin{split}
      C(t_e^{opt}(t_0); \beta, \gamma, t^*) & = tt_a(t_e^{opt}(t_0)) + \beta(t^* - t_e^{opt}(t^*)) \\
                                            & = tt_a(t_e^{opt}(t_0)) + \beta(t_0 - t_e^{opt}(t^*)) + \beta(t^* - t_0) \\
                                            & = C(t_e^{opt}(t_0); \beta, \gamma, t_0) + \beta(t^* - t_0)
    \end{split}
  \end{equation}
  and, similarly,
  \begin{equation*}
    C(t_e^{opt}(t^*); \beta, \gamma, t^*) = C(t_e^{opt}(t^*); \beta, \gamma, t_0) + \beta(t^* - t_0)
  \end{equation*}

  But since \(t_e^{opt}(t^*)\) is the minimizer for the cost when desiring arrival at \(t^*\),
  allowing the inequality to be strict would mean
  \begin{align*}
    C(t_e^{opt}(t^*); \beta, \gamma, t^*) & < C(t_e^{opt}(t_0); \beta, \gamma, t^*) \\
    C(t_e^{opt}(t^*); \beta, \gamma, t_0) + \beta(t^* - t_0) & < C(t_e^{opt}(t_0); \beta, \gamma, t_0) + \beta(t^* - t_0) \\
    C(t_e^{opt}(t^*); \beta, \gamma, t_0) & < C(t_e^{opt}(t_0); \beta, \gamma, t_0)
  \end{align*}
  that is a contradiction, since \(t_e^{opt}(t_0)\) is the minimizer when desiring arrival at \(t_0\).

  The last remaining case is when \(t_e^{opt}(t^*) \in [t_0, \bar{t_e})\).
  
  In this case, the continuity of the travel time function and the minimality of \(t_e\) imply that the value of the travel time function at \(t_e^{opt}(t^*)\) to be larger than the cost of an hypothetical early arrival at \(t_e^{opt}(t_0)\) when desiring arriving at \(t_e^{opt}(t^*)\).
  \footnote{This substantially means that in Figure~\ref{fig:early_arrivals_cost}, on the vertical line corresponding to \(t_e^{opt}(t_0)\), the function is above the lowest possible inclined line.}
  More formally,
  \begin{align*}
    tt_a(t_e^{opt}(t^*)) & > C(t_e^{opt}(t_0); \beta, \gamma, t_e^{opt}(t^*)) \\
    & = tt_a(t_e^{opt}(t^*)) + \beta(t_e^{opt}(t^*) - t_e^{opt}(t_0)) \\
    & > tt_a(t_e^{opt}(t_0))
  \end{align*}

  By using what shown in equation~\eqref{eq:shifting_desired}, we can thus prove the proposition:
  \begin{align*}
    C(t_e^{opt}(t_0); \beta, \gamma, t^*) & = C(t_e^{opt}(t_0); \beta, \gamma, t_e^{opt}(t^*)) + \beta(t^* - t_e^{opt}(t^*)) \\
                                          & < tt_a(t_e^{opt}(t_0)) + \beta(t^* - t_e^{opt}(t^*)) \\
                                          & < tt_a(t_e^{opt}(t^*)) + \beta(t^* - t_e^{opt}(t^*)) \\
                                          & = C(t_e^{opt}(t^*); \beta, \gamma, t^*)
  \end{align*}

  This shows that the cost of arriving at \(t_e^{opt}(t_0)\),
  when desired arrival time is \(t^*\),
  is lower than the cost of arriving at \(t_e^{opt}(t^*)\).
  It yields thus a contradiction,
  and proves the claim.

  If an early arrival is realized for some desired arrival time \(t_0\),
  we proved that there exists an interval \((t_e, \bar{t_e})\),
  where \(t_e = t_e^{opt}(t_0)\),
  such that
  \begin{equation*}
    t^* \in (t_e, \bar{t_e}) \implies t_e^{opt}(t^*) = t_e
  \end{equation*}

  Note now that the intervals have to be disjoint.
  To this end, suppose, again towards a contradiction,
  that exists one point that is in two different intervals:
  \begin{equation*}
    t_0 \in (t_e^1, \bar{t_e^1}) \cup (t_e^2, \bar{t_e^2})
  \end{equation*}

  For what proved above,
  every point in the same interval as \(t_0\) will have the same optimal early arrival as \(t_0\).
  But this means that all the points in the two intervals will share the same optimal early arrival,
  and this arrival can only be the minimum between \(t_e^1, t_e^2\).
  The points in one of the two intervals can thus be considered to belong to a single interval,
  namely
  \begin{equation*}
    (\min\{t_e^1, t_e^2\}, \max\{\bar{t_e^1}, \bar{t_e^2}\}) = (t_e^1, \bar{t_e^1}) \cap (t_e^2, \bar{t_e^2})
  \end{equation*}

  This proves the proposition for the early arrivals.
  For the case of late arrivals,
  the proof is symmetrical.
\end{proof}

\begin{figure}
  \centering
  \includegraphics[width=.8\textwidth]{early_arrivals_jump}
  \caption{How the optimal early arrival changes,
    when changing the parameter \(t^*\).
    When \(t^*\) is in one of the shaded zones,
    the optimal early arrival time \(t_e^{opt}\) will be constant and equal to the time that yielded the zone.
  Otherwise, the optimal early arrival does not exist.}
  \label{fig:early_arrivals_jump}
\end{figure}

Figure~\ref{fig:early_arrivals_jump} shows this behaviour:
when \(t^*\) falls in the shaded zones,
the optimal early arrival \(t_e^{opt}\) is constant (in each of the zones).
If \(t^*\) is not in the zones,
the optimal early arrival is not defined:
for these values of the parameter,
the global minimum will be realized by either an on-time arrival (that is, \(t^{opt} = t^*\))
or by a late arrival.

The case of late arrival is, as expected, exactly symmetrical.

Once the dependency of the points \(t_e^{opt}, t_l^{opt}\) on the parameters has been explained,
the global minimum \(t^{opt}\) has to be characterized.
To this end, note that the optimum can only be smaller, greater or equal to \(t^*\):
\begin{obs}
  \label{obs:t_opt-dep}
  Given values for the parameters \(\beta, \gamma, t^*\) one out of the following is always true:
  \begin{itemize}
  \item \(t^{opt} = t_e^{opt}\) that is, the optimal arrival is an early arrival
  \item \(t^{opt} = t_l^{opt}\) that is, the optimal arrival is a late arrival
  \item \(t^{opt} = t^*\) that is, the optimal arrival is an on-time arrival
  \end{itemize}
\end{obs}

The following lemma gives a strong condition on when an on-time arrival can be realized:
\begin{lemma}
  \label{lemma:where-no-ot}
  Given the values for the parameters \(\beta, \gamma, t^*\),
  the optimal arrival time can be an on-time arrival (that is, \(t^{opt} = t^*\)) only if neither the optimal early arrival \(t_e^{opt}\) nor the optimal late arrival \(t_l^{opt}\) exist.
\end{lemma}
\begin{proof}
  Suppose the optimal early arrival \(t_e^{opt}\) to be defined,
  and \(t^*\) to be a local minimum of the cost function \(C(t_a)\)

  Note that the cost function is continuous,
  if the travel time function is so.
  This means that, in particular,
  \begin{equation*}
    \forall\, \varepsilon > 0,\ \exists \delta > 0 |\, C(t^* - \delta) < C(t^*) + \varepsilon
  \end{equation*}
  that is, there exist early arrivals whose cost approximate arbitrarily well the cost of the on-time arrival.

  Remind now that the arrival time \(t_e^{opt}\) is the best possible early arrival:
  this means that, for every choice of \(\delta > 0\),
  \begin{equation*}
    C(t_e^{opt}) \leq C(t^* - \delta)
  \end{equation*}
  and, finally, that for every choice of \(\varepsilon > 0\),
  \begin{equation*}
    C(t_e^{opt}) < C(t^*) + \varepsilon
  \end{equation*}

  This means that the soft equality holds for \(\varepsilon = 0\):
  \begin{equation*}
    C(t_e^{opt}) \leq C(t^*)
  \end{equation*}
  that proves the lemma.
\end{proof}

While the characterization of the points \(t_e^{opt}, t_l^{opt}\) was done in the proposition above,
describing the interaction between early and late arrivals is in general not easy,
and can be made simpler by assuming the travel time function to have some realistic features.

\begin{definition}
  \label{def:gen-tt-fun}
  Consider a function
  \begin{equation*}
    tt_a: \R \rightarrow \R
  \end{equation*}

  \(tt_a\) is said a \textbf{general travel time function} if it satisfies the following:
  \begin{enumerate}
  \item \(tt_a \in C^1(\R)\)\todo{Add limits to \(\pm\infty\). Adapt later, where it says \textit{first requirement} etc}
  \item \(tt_a'(t_a) < 1\ \forall\, t_a\in \R\)
  \item \(tt_a\) is unimodal
  \end{enumerate}
\end{definition}

The first requirement is not restrictive,
since the space \(C^1(\R)\) is dense in the space of continuous functions,
and the travel time function can be assumed to be continuous.
Requirement about the bounded derivative arises from Lemma~\ref{lemma:bounded-der-tt}.
Unimodality, finally, is a restrictive requirement that has never been mentioned earlier,
and simplifies the problem of describing the interactions of early and late arrivals.
It is anyway realistic:
if considering only one out of the morning and evening peak (that can be treated separately),
we indeed expect the traffic pattern to be unimodal\todo{Cite something}.

Under these assumptions, when a set of parameters results in an early or late arrival can be clearly stated:
it is indeed possible to find a point before which the arrivals can only be either early or on-time,
and after which the arrivals can only be late or on-time:

\begin{prop}
  \label{prop:split-early-late}
  Let \(tt_a\) be a general travel time function, the parameters \(\beta, \gamma\) be given.
  There exists a critical arrival time \(t_s(\beta, \gamma) \in \bar{\R} = \{\R \cup \pm \infty\}\) that satisfies
  \begin{itemize}
  \item \(t^{opt}(\beta, \gamma, t^*) \neq t_e^{opt}(\beta, \gamma, t^*)\) if \(t^* > t_s(\beta, \gamma)\)
  \item \(t^{opt}(\beta, \gamma, t^*) \neq t_l^{opt}(\beta, \gamma, t^*)\) if \(t^* < t_s(\beta, \gamma)\)
  \end{itemize}

  Moreover, when \(t^* = t_s(\beta, \gamma)\) arriving early or late yields the same cost:
  \begin{equation*}
    C(t_e^{opt}(\beta, \gamma, t_s); \beta, \gamma, t_s) = C(t_l^{opt}(\beta, \gamma, t_s); \beta, \gamma, t_s)
  \end{equation*}
\end{prop}
\begin{proof}
  
  
  % To prove the first part of the proposition,
  % it is enough to show that if 
  If there is no point realizing a late arrival, that is
  \begin{equation*}
    \nexists\, t^* |\, t^{opt}(t^*) = t_l^{opt}(t^*)\footnote{For the scope of this proposition, how the parameters \(\beta, \gamma\) change is not relevant:
  for notational simplicity, the dependency of the points \(t^{opt}, t_e^{opt}, t_l^{opt}\) on these parameters are thus hidden,
  and the only dependency to be explicitly denoted will be the one on the desired arrival time \(t^*\).}
  \end{equation*}
  then the proposition is true, for \(t_s = \infty\).

  Otherwise, consider a point \(t_0\) realizing a late arrival:
  \begin{equation*}
    t^{opt}(t_0) = t_l^{opt}(t_0)
  \end{equation*}

  We will now prove that a desired arrival time later than \(t_0\) cannot yield an early arrival:
  in the following, is shown that, given \(t_1 > t_0\),
  \begin{equation*}
    t^{opt}(t_1) \neq t_e^{opt}(t_0)
  \end{equation*}

  The proof will be divided in two different cases:
  \(t_1\) can be either greater or smaller than \(t_l^{opt}(t_0)\).

  At first, we suppose it to be smaller: \[t_1 \leq t_l^{opt}(t_0)\]

  This case will be again divided in two different cases:
  \(t_e^{opt}(t_1)\) can be either greater than \(t_0\) or smaller.

  Suppose now the second case:
  \begin{equation*}
    t_e^{opt}(t_1) \leq t_0
  \end{equation*}
  In this case, arrival at \(t_l^{opt}(t_0)\) is a realizable late arrival when the desired arrival time is \(t_1\) as well.
  Its cost will be lower than the cost of the same arrival,
  when the desired arrival time is \(t_0\):
  this is because the cost decreases on the distance between the desired arrival time (in this case, \(t_1\)) and the actual arrival time (in this case, \(t_l^{opt}(t_0)\)).
  \begin{align*}
    C(t_l^{opt}(t_0); \beta, \gamma, t_1) & = tt_a(t_l^{opt}(t_0)) + \gamma(t_l^{opt}(t_0) - t_1) \\
                                          & < tt_a(t_l^{opt}(t_0)) + \gamma(t_l^{opt}(t_0) - t_0) \\
                                          & = C(t_l^{opt}(t_0); \beta, \gamma, t_0)
  \end{align*}
  Moreover, the cost of every possible early arrival increases:
  the arrival time \(t_e^{opt}(t_1)\) is, on top of this, a realizable early arrival even when the desired arrival time is \(t_0\),
  and its cost is lower in this case:
  similarly, to the earlier computations,
  \begin{align*}
    C(t_e^{opt}(t_1); \beta, \gamma, t_1) & = tt_a(t_e^{opt}(t_1)) + \beta(t_1 - t_e^{opt}(t_1)) \\
                                          & > tt_a(t_e^{opt}(t_1)) + \beta(t_0 - t_e^{opt}(t_1)) \\
                                          & = C(t_e^{opt}(t_1); \beta, \gamma, t_0)
  \end{align*}
  There exists thus, when the desired arrival time is \(t_0\),
  a late arrival whose cost is lower than the one of the best early arrival:
  \begin{align*}
    C(t_l^{opt}(t_0); \beta, \gamma, t_1) & < C(t_l^{opt}(t_0); \beta, \gamma, t_0) \\
                                          & < C(t_e^{opt}(t_1); \beta, \gamma, t_0) \\
                                          & < C(t_e^{opt}(t_1); \beta, \gamma, t_1)
  \end{align*}

  Consider now the case in which the optimal early arrival is greater than the desired arrival \(t_0\):
  \begin{equation*}
    t_e^{opt}(t_1) > t_0
  \end{equation*}

  In this case, the travel time function has to be increasing at \(t_e^{opt}(t_1)\),
  being it an early arrival (as shown in Observation~\ref{obs:foc}),
  and by unimodality it has to be increasing at \(t_0\) as well.
  The cost of a late arrival at \(t_l^{opt}(t_0)\) is, on the other hand, decreasing:
  \begin{equation}
    \label{eq:cost-comp-1}
    \begin{split}
      C(t_l^{opt}(t_0); \beta, \gamma, t_1) & = tt_a(t_l^{opt}(t_0)) + \gamma(t_l^{opt}(t_0) - t_1) \\
                                            & < tt_a(t_l^{opt}(t_0)) + \gamma(t_l^{opt}(t_0) - t_0) \\
                                            & = C(t_l^{opt}(t_0); \beta, \gamma, t_0)
    \end{split}
  \end{equation}

  Moreover, the optimality of \(t_l^{opt}(t_0)\), when the desired arrival time is \(t_0\), yields
  \begin{equation}
    \label{eq:cost-comp-2}
    \begin{split}
      C(t_l^{opt}(t_0); \beta, \gamma, t_0) & < C(t_0; \beta, \gamma, t_0) \\
                                            & = tt_a(t_0)
    \end{split}
  \end{equation}

  Suppose now \(t_e^{opt}(t_1) > t_0\).

  Being the function \(tt_a\) increasing, its value in \(t_e^{opt}(t_1)\) will be greater than at \(t_0\):
  \begin{equation}
    \label{eq:decreasing-tt_a}
    tt_a(t_0) \leq tt_a(t_e^{opt}(t_1))
  \end{equation}

  Finally, the cost of an arrival at \(t_e^{opt}(t_1)\) will be lower bounded by the travel time:
  \begin{equation}
    \label{eq:cost-low-bound}
    \begin{split}
      C(t_e^{opt}(t_1); \beta, \gamma, t_1) & = tt_a(t_e^{opt}(t_1)) + \beta(t_1 - t_e^{opt}(t_1)) \\
                                            & > tt_a(t_e^{opt}(t_1))
    \end{split}
  \end{equation}

  By using equations \eqref{eq:cost-comp-1}, \eqref{eq:cost-comp-2}, \eqref{eq:decreasing-tt_a} and \eqref{eq:cost-low-bound},
  we get
  \begin{align*}
    C(t_e^{opt}(t_1); \beta, \gamma, t_1) & > tt_a(t_e^{opt}(t_1)) \\
                                          & \geq tt_a(t_0) \\
                                          & > C(t_l^{opt}; \beta, \gamma, t_0) \\
                                          & > C(t_l^{opt}(t_0); \beta, \gamma, t_1)
  \end{align*}
  showing that there is a late arrival whose cost is smaller than the best early arrival for \(t_1\).


  Consider, finally, the case in which \[t_1 > t_l^{opt}(t_0)\]

  Note that the reasoning above shows, given the arbitrariness of the choice of \(t_1\),
  \begin{align*}
    C(t_e^{opt}(t_1); \beta, \gamma, t_1) & > C(t_l^{opt}(t_0); \beta, \gamma, t_l^{opt}(t_0)) \\
                                          & = tt_a(t_l^{opt}(t_0))
  \end{align*}
  where, in the last line, the cost has been computed.

  Note now that the function \(tt_a\) has to be decreasing (again, given Observation~\ref{obs:foc}) at \(t_l^{opt}(t_0)\) and,
  as a consequence of unimodality,
  will be so until \(t_1\). This implies
  \begin{equation*}
    tt_a(t_1) \leq tt_a(t_l^{opt}(t_0))
  \end{equation*}

  The value of the travel time is a lower bound for the optimal cost,
  being it the cost of an on-time arrival.
  An early arrival will thus not be realized,
  since the cost for an on-time arrival will be lower:
  \begin{align*}
    C(t_1; \beta, \gamma, t_1) & = tt_a(t_1) \\
                               & \leq tt_a(t_l^{opt}(t_0)) \\
                               & = C(t_l^{opt}(t_0); \beta, \gamma, t_l^{opt}(t_0)) \\
                               & < C(t_e^{opt}(t_1); \beta, \gamma, t_1)
  \end{align*}

  This shows that \(t_1\) cannot yield an early arrival,
  if the function \(tt_a\) is decreasing at \(t_0\).

  This reasoning shows that, given a desired arrival time that realizes a late arrival,
  a greater desired arrival time will never yield an early arrival.

  A symmetric reasoning will show the same for early arrivals:
  given a desired arrival time that yields an early arrival,
  no earlier desired arrival times will yield late arrivals.

  These two statements prove the first part of the proposition:
  let indeed
  \begin{align*}
    t_{s, l} & = \inf\{t^* |\, t^{opt}(t^*) = t_l^{opt}(t^*)\} \\
    t_{s, e} & = \sup\{t^* |\, t^{opt}(t^*) = t_e^{opt}(t^*)\}
  \end{align*}

  Any choice of \(t_s \in [t_{s, e}, t_{s, l}]\) will satisfy the two requirements for \(t_s\).

  Regarding the second part of the proposition,
  that is, that the cost of arriving early or late at \(t_s\) is the same,
  it simply follows from a careful choice of the value \(t_s\).

  Note indeed that the cost of arriving early continuously grows as the value of \(t_s\) is increased from \(t_{s, e}\),
  while the cost of arriving late continuously grows as \(t_s\) is decreased from \(t_{s, l}\).

  Since the cost of arriving late when desiring \(t_{s, e}\) is greater than the cost of arriving early,
  and the cost of arriving early when desiring \(t_{s, l}\) is greater than the cost of arriving late,
  there has to be a value for \(t_s\) that satisfies the claim.\todo{Better argue this}
\end{proof}

This proposition is the last result of the section,
as, if considered together with Proposition~\ref{prop:into-early-late} and Lemma~\ref{lemma:where-no-ot},
it completely characterizes the function \(t^{opt}(\beta, \gamma, t^*\).

It indeed defines a critical point,
dependant on the value of the parameters \(\beta, \gamma\),
that splits the domain of the function (in the dimension in which lies \(t^*\))
into two separate zones.

Into the two zones, Proposition~\ref{prop:into-early-late} can be used to compute the exact minimum:
Once the intervals where the optimal early (or late) arrival is defined,
Lemma~\ref{lemma:where-no-ot} can be applied to precisely characterize the type of arrival that is realized for the given values of the parameters and,
eventually, at what time the arrival occurs.

This will be at the core of the method used in the next section:
in a slightly simpler setting, the arrival time \(t_s\) will be computed,
as well as the points \(t_e, \bar{t_e}, t_l, \bar{t_l}\).
The value of the parameter \(t^*\) will then be compared to these points

%%% Local Variables:
%%% mode: LaTeX
%%% TeX-master: "../main"
%%% End:
